# Fairfield Private Relay Configuration
# strfry.conf - NIP-29 Groups Relay

##
## Network Settings
##

db = "/app/strfry-db/"

relay {
    # Relay Information (NIP-11)
    name = "Fairfield Private Relay"
    description = "Private relay for Fairfield community - no federation"
    pubkey = ""  # Set to admin hex pubkey
    contact = "admin@fairfield.example"

    # Bind settings
    bind = "0.0.0.0"
    port = 7777

    # No TLS (Caddy handles it)
    noTLS = true

    # Connection limits
    maxWebsocketPayloadKB = 131072

    # Rate limiting
    autoPingSeconds = 55
    enableTCPKeepalive = false

    # Event limits
    maxFilterLimit = 500
    maxSubsPerConnection = 20
}

##
## NIP-42 Authentication
##

events {
    # Require authentication for all events
    rejectEventsNewerThanSeconds = 900
    rejectEventsOlderThanSeconds = 94608000
    rejectEphemeralEventsOlderThanSeconds = 60
    ephemeralEventsLifetimeSeconds = 300
    maxEventSize = 65536
    maxNumTags = 2000
    maxTagValSize = 1024
}

##
## Write Policy Plugin (NIP-42 AUTH)
##

writePolicy {
    # Require NIP-42 authentication
    plugin = "/app/plugins/auth-whitelist.js"
}

##
## Storage Settings
##

negentropy {
    enabled = true
    maxSyncEvents = 1000000
}

# Database settings
dbParams {
    # Maximum database size: 1GB
    maxreaders = 256
    mapsize = 1073741824
}

##
## Compression
##

compression {
    enabled = true
    level = 3
}

##
## Logging
##

logging {
    level = "info"
}

##
## NIP Support
##
## Supported NIPs: 1, 2, 9, 11, 29, 42, 44, 59
